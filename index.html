<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Age Calculator â€” Telegram WebApp</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{
      --primary:#3b82f6;     /* blue */
      --primary2:#06b6d4;    /* cyan */
      --halo1:#93c5fd;       /* blue glow */
      --halo2:#22d3ee;       /* teal glow */

      --bg1:#eef6ff;
      --bg2:#f7fbff;
      --surface:#ffffff;
      --text:#0f172a;
      --muted:#667085;
      --ring:rgba(59,130,246,.28);
      --shadow:0 10px 30px rgba(16,24,40,.08),0 2px 8px rgba(16,24,40,.05);
      --radius:16px;
    }
    body.tg-dark{
      --bg1:#0e1117; --bg2:#0c0f14; --surface:#121826;
      --text:#e5e7eb; --muted:#9ca3af; --ring:rgba(59,130,246,.32);
      --shadow:0 12px 30px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 50% -120px, #c7e0ff66, transparent 60%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }
    .wrap{ max-width:560px; margin:40px auto; padding:0 18px; }

    .shell{
      border-radius:28px; padding:28px 20px 22px; box-shadow:var(--shadow);
      background:linear-gradient(180deg,#ffffffaa, #ffffff30);
      border:1px solid rgba(59,130,246,.18);
      backdrop-filter: blur(6px);
      position:relative; overflow:hidden;
    }

    .blob{
      position:absolute; width:420px; height:420px; filter: blur(58px); opacity:.35; z-index:0;
      background: radial-gradient(closest-side, #93c5fd 0%, transparent 60%);
      top:-140px; left:-140px; animation: blobMove 16s ease-in-out infinite alternate;
    }
    .blob.b2{
      width:360px; height:360px; background: radial-gradient(closest-side, #22d3ee 0%, transparent 60%);
      top:auto; bottom:-160px; right:-140px; left:auto; animation: blobMove 18s ease-in-out infinite alternate;
    }
    @keyframes blobMove{ 0%{ transform: translate(0,0) rotate(0);} 100%{ transform: translate(40px,30px) rotate(10deg);} }

    .hero{ position:relative; z-index:1; text-align:center; }
    .orb{
      width:100px; height:100px; margin:0 auto 10px; border-radius:50%;
      display:grid; place-items:center; color:#fff; position:relative;
      background:conic-gradient(from 200deg, var(--primary), var(--primary2));
      box-shadow: 0 18px 40px rgba(59,130,246,.35);
      animation: float 6s ease-in-out infinite;
    }
    .orb:after{
      content:""; position:absolute; inset:0; border-radius:inherit;
      background:
        radial-gradient(circle at 30% 70%, color-mix(in oklab, var(--halo1) 70%, transparent) 0 22%, transparent 46%),
        radial-gradient(circle at 0% 100%, color-mix(in oklab, var(--halo2) 35%, transparent) 0 62%, transparent 74%);
      mix-blend-mode: screen; pointer-events:none;
    }
    .orb i{ font-size:36px; filter: drop-shadow(0 6px 12px rgba(0,0,0,.18)); }
    .orb .ring{
      position:absolute; inset:-8px; border-radius:50%;
      border:8px solid transparent;
      border-top-color: color-mix(in oklab, var(--halo1) 90%, transparent);
      border-left-color: color-mix(in oklab, var(--halo2) 75%, transparent);
      filter: blur(.5px);
      animation: spin 10s linear infinite;
    }
    @keyframes float{ 0%{ transform: translateY(0);} 50%{ transform: translateY(-8px);} 100%{ transform: translateY(0);} }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    h1{ font-size:30px; margin:6px 0 4px; font-weight:900; letter-spacing:.2px; }
    .sub{ margin:0 auto 16px; max-width:440px; color:var(--muted); font-weight:600; letter-spacing:.1px; }

    .card{
      background:var(--surface); border-radius:var(--radius); padding:16px; margin:14px 0; position:relative; z-index:1;
      border:1px solid rgba(2,6,23,.06); box-shadow:0 8px 24px rgba(16,24,40,.06);
      opacity:0; transform: translateY(12px) scale(.98);
      transition: transform .6s cubic-bezier(.2,.7,.2,1), opacity .6s;
    }
    .card.show{ opacity:1; transform: translateY(0) scale(1); }

    .label{ font-weight:700; display:flex; align-items:center; gap:8px; margin-bottom:10px;}
    .input-row{ display:flex; gap:10px; align-items:center; }

    input[type="date"]{
      width:100%; appearance:none; -webkit-appearance:none;
      padding:14px 14px; border-radius:12px; border:1px solid #e5e7eb; outline:0; font-size:15px; background:#fff; color:var(--text);
      transition: .25s;
    }
    input[type="date"]:focus{ border-color:var(--primary); box-shadow:0 0 0 6px var(--ring); }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:700; font-size:15px; position:relative; overflow:hidden;
    }
    .btn-primary{
      flex:1; color:#fff;
      background: linear-gradient(90deg, var(--primary), var(--primary2), var(--primary));
      background-size: 200% 100%; animation: bgShift 6s linear infinite;
      box-shadow: 0 10px 22px rgba(59,130,246,.28);
      transition: transform .12s ease;
      isolation:isolate;
    }
    .btn-primary:hover{ transform: translateY(-1px); }
    .btn-primary:active{ transform: translateY(1px) scale(.99); }
    .btn-primary::before{
      content:""; position:absolute; top:0; left:-150%; width:120%; height:100%;
      background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,.28) 50%, transparent 100%);
      transform: skewX(-20deg);
    }
    .btn-primary.shine::before{ animation: btnShine .8s ease-out forwards; }
    .btn-primary.pulse::after{ content:""; position:absolute; inset:-4px; border-radius:inherit; border:2px solid rgba(59,130,246,.45); opacity:0; animation: btnPulse .6s ease-out; }

    @keyframes bgShift{ 0%{ background-position:0% 0 } 100%{ background-position:200% 0 } }
    @keyframes btnShine{ to{ left:150%; } }
    @keyframes btnPulse{ 0%{ transform:scale(1); opacity:.7 } 100%{ transform:scale(1.08); opacity:0 } }

    .btn-ghost{ width:46px; height:46px; background:#fff; border:1px solid #e5e7eb; }

    /* Send to Telegram button with plane take-off */
    .btn-send{
      --g: linear-gradient(90deg, var(--primary), var(--primary2));
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:999px;
      border:1.5px solid transparent;
      background: linear-gradient(#ffffff,#ffffff) padding-box, var(--g) border-box;
      color:var(--primary); font-weight:800; transition:.2s; position:relative; overflow:hidden;
    }
    .btn-send:hover{ transform: translateY(-1px); box-shadow:0 10px 22px rgba(59,130,246,.12); }
    .btn-send .plane{
      width:22px; height:22px; border-radius:50%; background: var(--g); color:#fff; display:grid; place-items:center;
      box-shadow:0 6px 14px rgba(59,130,246,.25); position:relative; transition: transform .25s ease;
    }
    .btn-send:hover .plane{ transform: translateX(2px); }
    .btn-send.fly .plane{ animation: planeFly .8s ease-in-out; }
    .btn-send.fly .plane::after{
      content:""; position:absolute; left:-8px; top:50%; width:32px; height:8px; border-radius:8px;
      background:linear-gradient(90deg, var(--primary2), var(--primary)); filter: blur(4px); opacity:0;
      transform: translate(-120%, -50%) scaleX(.6); animation: trail .8s ease-out;
    }
    @keyframes planeFly{ 0%{ transform: translate(0,0) rotate(0) } 60%{ transform: translate(26px,-8px) rotate(15deg) } 100%{ transform: translate(0,0) rotate(0) } }
    @keyframes trail{ 0%{ opacity:0; transform: translate(-120%,-50%) scaleX(.6) } 30%{ opacity:.75 } 100%{ opacity:0; transform: translate(10px,-50%) scaleX(1) } }

    .ripple{ position:absolute; border-radius:50%; transform:scale(0); background:rgba(255,255,255,.6); animation:ripple .6s ease-out; pointer-events:none; }
    @keyframes ripple{ to{ transform:scale(4); opacity:0; } }

    .muted-box{ text-align:center; color:var(--muted); padding:22px 12px; }

    /* KPI tiles + animated border */
    .age-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:6px; }
    .kpi{
      position:relative; overflow:hidden;
      background:linear-gradient(180deg,#ffffff, #f6f9ff); border:1px solid rgba(2,6,23,.06);
      border-radius:14px; padding:14px; text-align:center; box-shadow:0 6px 16px rgba(16,24,40,.05);
    }
    .kpi::before{
      content:""; position:absolute; inset:-2px; padding:2px; border-radius:inherit;
      background: conic-gradient(from 0deg, rgba(59,130,246,.85), rgba(6,182,212,.85), rgba(59,130,246,.85));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask-composite: exclude;
      animation: spin 6s linear infinite; opacity:.35; pointer-events:none;
    }
    .kpi .num{ font-size:28px; font-weight:800; background:linear-gradient(90deg,var(--primary),var(--primary2)); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .kpi .lbl{ font-size:12px; color:var(--muted); margin-top:4px; }

    .row{ display:flex; align-items:center; gap:12px; }
    .icon-badge{
      width:42px; height:42px; border-radius:12px; display:grid; place-items:center; color:#fff;
      background:linear-gradient(180deg, var(--primary), var(--primary2));
      box-shadow:0 10px 20px rgba(59,130,246,.25);
      position:relative; overflow:hidden; animation: badgePop .5s cubic-bezier(.2,.8,.2,1);
    }
    .icon-badge::after{
      content:""; position:absolute; inset:-40% -70% auto auto; height:200%; width:40%;
      background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,.35) 50%, transparent 100%);
      transform: rotate(25deg) translateX(-180%); animation: badgeSheen 4.5s linear infinite;
    }
    @keyframes badgeSheen{ to{ transform: rotate(25deg) translateX(220%); } }
    @keyframes badgePop{ 0%{ transform: scale(.6); opacity:0 } 100%{ transform: scale(1); opacity:1 } }

    .icon-orange{
      background:linear-gradient(180deg,#fbbf24,#f59e0b);
      color:#111827; box-shadow:0 10px 20px rgba(245,158,11,.25);
    }
    .icon-orange i{ animation: twinkle 2.4s ease-in-out infinite; }
    @keyframes twinkle{ 0%,100%{ transform: rotate(0) scale(1) } 50%{ transform: rotate(-8deg) scale(1.08) } }

    .big{ font-size:22px; font-weight:800; }
    .desc{ color:var(--muted); font-size:13px; }
    .value{ margin-left:auto; font-weight:800; font-size:22px; }

    .fun-list{ list-style:none; padding:0; margin:6px 0 0; }
    .fun-list li{ display:flex; justify-content:space-between; gap:12px; padding:10px 2px; border-top:1px dashed rgba(2,6,23,.08); }
    .fun-list li:first-child{ border-top:0; }
    .hint{ font-size:12px; color:var(--muted); margin-top:8px; }

    /* Progress ring + moving dot */
    .ringwrap{ position:relative; width:80px; height:80px; }
    .ringwrap svg{ transform: rotate(-90deg); }
    .ringwrap .txt{ position:absolute; inset:0; display:grid; place-items:center; font-weight:800; font-size:18px; color:var(--primary); }
    .ringwrap .dot{
      position:absolute; left:50%; top:50%;
      width:12px; height:12px; border-radius:50%;
      background:linear-gradient(180deg,var(--primary),var(--primary2));
      border:2px solid #fff; transform-origin: center; transform: rotate(0deg) translateY(-34px);
      box-shadow:0 6px 14px rgba(59,130,246,.35);
      transition: transform 1.2s cubic-bezier(.2,.7,.2,1);
    }

    /* Footer */
    .footer-actions{ display:flex; gap:10px; margin-top:6px; justify-content:flex-end; }
    /* credit initially hidden; will show after results */
    #credit{ display:none; text-align:center; margin-top:12px; opacity:0; transform: translateY(6px) scale(.98); transition:.45s; }
    #credit.show{ opacity:1; transform: translateY(0) scale(1); }
    #credit a.credit-chip{
      display:inline-flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px;
      background:#fff; border:1px solid rgba(59,130,246,.35); box-shadow:0 8px 18px rgba(59,130,246,.12);
      color:var(--text); text-decoration:none; font-weight:800; position:relative; overflow:hidden; transition:.2s;
    }
    #credit a.credit-chip:hover{ transform: translateY(-1px); box-shadow:0 10px 22px rgba(59,130,246,.18); }
    #credit a.credit-chip::after{
      content:""; position:absolute; inset:0; background:linear-gradient(90deg, transparent, rgba(59,130,246,.08), transparent);
      transform: translateX(-100%); transition: transform .6s ease;
    }
    #credit a.credit-chip:hover::after{ transform: translateX(100%); }
    #credit .avatar{
      width:26px; height:26px; border-radius:8px; display:grid; place-items:center; color:#fff;
      background:linear-gradient(180deg, var(--primary), var(--primary2));
      font-weight:900; font-size:14px; letter-spacing:.5px;
    }
    #credit .tg{ color:var(--primary); filter: drop-shadow(0 2px 8px rgba(59,130,246,.25)); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="shell">
      <div class="blob"></div><div class="blob b2"></div>

      <div class="hero">
        <div class="orb"><div class="ring"></div><i class="fa-regular fa-calendar"></i></div>
        <h1>Age Calculator</h1>
        <p class="sub">Calculate your exact age, total days lived, and next birthday</p>
      </div>

      <div class="card show" id="formCard">
        <div class="label"><i class="fa-regular fa-calendar"></i> Select your birth date</div>
        <div class="input-row">
          <input id="dob" type="date" placeholder="dd/mm/yyyy" />
        </div>
        <div class="input-row" style="margin-top:12px">
          <button id="calcBtn" class="btn btn-primary"><i class="fa-regular fa-square-check"></i> Calculate</button>
          <button id="resetBtn" class="btn btn-ghost" title="Reset"><i class="fa-solid fa-rotate-right"></i></button>
        </div>
      </div>

      <!-- FIRST PAGE placeholder (visible on load) -->
      <div id="results">
        <div class="card show" id="emptyCard">
          <div class="muted-box">
            <i class="fa-regular fa-calendar" style="font-size:28px; color:#9ca3af"></i>
            <div style="margin-top:8px">Pick a birth date and enjoy results.</div>
          </div>
        </div>
      </div>

      <div class="footer-actions">
        <!-- Animated send button (only inside Telegram) -->
        <button id="sendBtn" class="btn-send" style="display:none">
          <span class="plane"><i class="fa-brands fa-telegram"></i></span>
          <span class="label">Send to Telegram</span>
        </button>
      </div>

      <!-- Credit chip (appears after results) -->
      <div class="credit" id="credit">
        <a href="https://t.me/NOBIN_39" id="nobinLink" class="credit-chip" rel="noopener">
          <span class="avatar">N</span>
          <span>Made by <b>Nobin</b></span>
          <i class="fa-brands fa-telegram tg"></i>
        </a>
      </div>
    </div>
  </div>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const $ = s => document.querySelector(s);
    const dobInput = $('#dob');
    const calcBtn = $('#calcBtn');
    const resetBtn = $('#resetBtn');
    const results = $('#results');
    const sendBtn = $('#sendBtn');
    const credit = $('#credit');
    const nobinLink = $('#nobinLink');
    const tg = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;

    // Telegram theme
    if (tg){
      try{ tg.ready(); tg.expand(); if (tg.colorScheme === 'dark') document.body.classList.add('tg-dark'); }catch(e){}
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
      document.body.classList.add('tg-dark');
    }

    // Credit link â†’ Telegram profile
    nobinLink.addEventListener('click', e=>{
      e.preventDefault();
      const url = 'https://t.me/NOBIN_39';
      try{ if (tg && tg.openTelegramLink) tg.openTelegramLink(url); else window.open(url,'_blank'); }
      catch(_){ window.open(url,'_blank'); }
    });

    // ripple for primary buttons
    document.addEventListener('click', e=>{
      const btn = e.target.closest('.btn');
      if (!btn) return;
      const r = document.createElement('span');
      const d = Math.max(btn.offsetWidth, btn.offsetHeight);
      r.className='ripple'; r.style.width=r.style.height=d+'px';
      const rect = btn.getBoundingClientRect();
      r.style.left = (e.clientX - rect.left - d/2)+'px';
      r.style.top = (e.clientY - rect.top - d/2)+'px';
      btn.appendChild(r); setTimeout(()=>r.remove(), 650);
    });

    calcBtn.addEventListener('click', onCalculate);
    resetBtn.addEventListener('click', resetAll);
    dobInput.addEventListener('keydown', e=>{ if(e.key==='Enter') onCalculate(); });

    async function onCalculate(){
      const dob = parseDOB(dobInput.value);
      if(!dob){ toast('Please select a valid birth date.'); pulseCalc(); return; }
      const now = new Date();
      if(dob > now){ toast('Birth date cannot be in the future.'); pulseCalc(); return; }

      // Button feedback
      pulseCalc(); shineCalc();
      const prevHTML = calcBtn.innerHTML;
      calcBtn.disabled = true;
      calcBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Calculating...`;
      if (tg && tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
      await new Promise(r=>setTimeout(r, 360));

      const dif = diffYMD(dob, now);
      const totalDays = diffDays(startOfDay(dob), startOfDay(now));
      const daysToNext = daysUntilNextBirthday(dob, now);
      const diffMs = now - dob;
      const minutes = Math.floor(diffMs/60000);
      const hours = Math.floor(diffMs/3600000);
      const beats = Math.floor(minutes * 80);
      const {daysInYear, daysSinceLast, percentToNext} = birthdayProgress(dob, now);

      // Results UI
      results.innerHTML = `
        <div class="card">
          <div class="row">
            <div class="icon-badge"><i class="fa-regular fa-calendar-check"></i></div>
            <div>
              <div class="big">Your Age</div>
              <div class="desc">From ${fmtDate(dob)} to today</div>
            </div>
          </div>
          <div class="age-grid">
            <div class="kpi"><div class="num" data-anim="${dif.years}">0</div><div class="lbl">Years</div></div>
            <div class="kpi"><div class="num" data-anim="${dif.months}">0</div><div class="lbl">Months</div></div>
            <div class="kpi"><div class="num" data-anim="${dif.days}">0</div><div class="lbl">Days</div></div>
          </div>
        </div>

        <div class="card">
          <div class="row">
            <div class="icon-badge"><i class="fa-regular fa-calendar-days"></i></div>
            <div>
              <div class="big">Total Days Lived</div>
              <div class="desc">Since birth</div>
            </div>
            <div class="value"><span class="count" data-anim="${totalDays}">0</span></div>
          </div>
        </div>

        <div class="card">
          <div class="row" style="align-items:center; gap:16px">
            <div class="ringwrap">
              <svg width="80" height="80">
                <circle cx="40" cy="40" r="34" stroke="rgba(107,114,128,.25)" stroke-width="8" fill="none"/>
                <circle id="ring" cx="40" cy="40" r="34" stroke="url(#g1)" stroke-width="8" stroke-linecap="round" fill="none" />
                <defs>
                  <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stop-color="var(--primary)"/>
                    <stop offset="100%" stop-color="var(--primary2)"/>
                  </linearGradient>
                </defs>
              </svg>
              <div class="dot" id="ringDot"></div>
              <div class="txt" id="ringTxt">0%</div>
            </div>
            <div>
              <div class="big">Next Birthday</div>
              <div class="desc">Days remaining</div>
            </div>
            <div class="value"><span class="count" data-anim="${daysToNext}">0</span></div>
          </div>
          <div class="hint" style="margin-top:10px">
            This year has ${daysInYear} days between your birthdays; youâ€™ve passed <b>${daysSinceLast}</b> days.
          </div>
        </div>

        <div class="card">
          <div class="row" style="margin-bottom:6px">
            <div class="icon-badge icon-orange"><i class="fa-solid fa-star"></i></div>
            <div class="big">Fun Facts</div>
          </div>
          <ul class="fun-list">
            <li><span>Hours lived</span><b class="count" data-anim="${hours}">0</b></li>
            <li><span>Minutes lived</span><b class="count" data-anim="${minutes}">0</b></li>
            <li><span>Heartbeats (approx.)</span><b class="count" data-anim="${beats}">0</b></li>
          </ul>
          <div class="hint">Assuming ~80 BPM average heart rate.</div>
        </div>
      `;

      revealCards();
      document.querySelectorAll('[data-anim]').forEach(el=> animateNumber(el, +el.getAttribute('data-anim')));
      animateRing($('#ring'), $('#ringTxt'), percentToNext, $('#ringDot'));

      if (tg){
        sendBtn.style.display = 'inline-flex';
        sendBtn.innerHTML = `<span class="plane"><i class="fa-brands fa-telegram"></i></span><span class="label">Send to Telegram</span>`;
        sendBtn.onclick = () => {
          animateSendBtn();
          const payload = { dob: fmtDate(dob), age:dif, totalDays, daysToNext, hours, minutes, heartbeats: beats };
          try{
            tg.sendData(JSON.stringify({type:'age_result', payload}));
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
          }catch(e){ toast('Could not send to Telegram.'); }
        };
      } else {
        sendBtn.style.display = 'none';
      }

      // Show credit chip after results (was hidden initially)
      credit.style.display = 'block';
      requestAnimationFrame(()=> credit.classList.add('show'));

      try{ confetti({ particleCount: 110, spread: 70, origin: { y: 0.15 } }); }catch(e){}

      calcBtn.innerHTML = prevHTML;
      calcBtn.disabled = false;
    }

    function animateSendBtn(){
      sendBtn.classList.add('fly');
      setTimeout(()=> sendBtn.classList.remove('fly'), 820);
      const prev = sendBtn.innerHTML;
      setTimeout(()=>{ sendBtn.innerHTML = `<span class="plane" style="background:linear-gradient(180deg,#10b981,#059669)"><i class="fa-solid fa-check"></i></span><span class="label">Sent!</span>`; }, 420);
      setTimeout(()=>{ sendBtn.innerHTML = prev; }, 1600);
    }

    function pulseCalc(){ calcBtn.classList.add('pulse'); setTimeout(()=>calcBtn.classList.remove('pulse'), 650); }
    function shineCalc(){ calcBtn.classList.add('shine'); setTimeout(()=>calcBtn.classList.remove('shine'), 820); }

    function resetAll(){
      dobInput.value = '';
      results.innerHTML = `
        <div class="card show" id="emptyCard">
          <div class="muted-box">
            <i class="fa-regular fa-calendar" style="font-size:28px; color:#9ca3af"></i>
            <div style="margin-top:8px">Pick a birth date and enjoy results.</div>
          </div>
        </div>`;
      if (tg) sendBtn.style.display='none';
      credit.classList.remove('show');
      credit.style.display='none';
    }

    // Utils
    const startOfDay = d => new Date(d.getFullYear(), d.getMonth(), d.getDate());
    function parseDOB(v){ if(!v) return null; const d = new Date(v); return isNaN(d)?null:d; }
    const diffDays = (a,b)=> Math.floor((b - a)/86400000);
    const daysInMonth = (y,m)=> new Date(y, m+1, 0).getDate();
    const isLeap = y => (y%4===0 && y%100!==0) || (y%400===0);
    function fmtDate(d){ const dd = String(d.getDate()).padStart(2,'0'); const mm = String(d.getMonth()+1).padStart(2,'0'); const yy = d.getFullYear(); return `${dd}/${mm}/${yy}`; }
    function diffYMD(a,b){
      let y=b.getFullYear()-a.getFullYear(); let m=b.getMonth()-a.getMonth(); let d=b.getDate()-a.getDate();
      if(d<0){ m--; d += daysInMonth(b.getFullYear(), (b.getMonth()+11)%12); }
      if(m<0){ y--; m+=12; }
      return {years:y, months:m, days:d};
    }
    function daysUntilNextBirthday(dob, ref){
      const today = startOfDay(ref);
      let m = dob.getMonth(), d = dob.getDate();
      if (m===1 && d===29 && !isLeap(today.getFullYear())) d=28;
      let next = new Date(today.getFullYear(), m, d);
      if (next < today) { const ny = today.getFullYear()+1; next = new Date(ny, m, (m===1 && dob.getDate()===29 && !isLeap(ny)) ? 28 : d); }
      return Math.ceil((startOfDay(next)-today)/86400000);
    }
    function birthdayProgress(dob, ref){
      const today = startOfDay(ref);
      const curYear = today.getFullYear();
      let last = new Date(curYear, dob.getMonth(), dob.getDate());
      let next = new Date(curYear, dob.getMonth(), dob.getDate());
      if (dob.getMonth()===1 && dob.getDate()===29){
        if (!isLeap(curYear)){ last = new Date(curYear,1,28); next = new Date(curYear,1,28); }
        if (!isLeap(curYear+1) && next < today) next = new Date(curYear+1,1,28);
      }
      if (last > today) last.setFullYear(curYear-1);
      if (next <= today) next.setFullYear(next.getFullYear()+1);
      const daysSinceLast = diffDays(last, today);
      const daysToNext = diffDays(today, next);
      const daysInYear = daysSinceLast + daysToNext;
      const percentToNext = Math.round((daysSinceLast / daysInYear) * 100);
      return {daysInYear, daysSinceLast, percentToNext};
    }

    function animateNumber(el, to, duration=1200){
      const start = performance.now(), from = 0, fmt = n => n.toLocaleString();
      function frame(now){
        const t = Math.min(1, (now - start)/duration);
        const eased = 1 - Math.pow(1 - t, 3);
        const val = Math.round(from + (to - from) * eased);
        el.textContent = fmt(val);
        if (t<1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    function animateRing(circle, txtEl, percent, dotEl){
      const r = 34, C = 2*Math.PI*r;
      circle.style.strokeDasharray = `${C} ${C}`;
      circle.style.strokeDashoffset = C;
      if (dotEl){
        dotEl.style.transition = 'transform 1.2s cubic-bezier(.2,.7,.2,1)';
        dotEl.style.transform = `rotate(0deg) translateY(-34px)`;
      }
      requestAnimationFrame(()=>{
        circle.style.transition = `stroke-dashoffset 1.2s cubic-bezier(.2,.7,.2,1)`;
        circle.style.strokeDashoffset = C * (1 - percent/100);
        if (dotEl){ const deg = percent/100 * 360; dotEl.style.transform = `rotate(${deg}deg) translateY(-34px)`; }
      });
      animateNumber(txtEl, percent, 1000);
      setTimeout(()=>{ txtEl.textContent = txtEl.textContent.replace(/,/g,'') + '%'; },1100);
    }

    function revealCards(){
      [...document.querySelectorAll('#results .card')].forEach((c,i)=>{
        setTimeout(()=>c.classList.add('show'), i*90+30);
      });
    }

    function pulseCalc(){ calcBtn.classList.add('pulse'); setTimeout(()=>calcBtn.classList.remove('pulse'), 650); }
    function shineCalc(){ calcBtn.classList.add('shine'); setTimeout(()=>calcBtn.classList.remove('shine'), 820); }

    function toast(msg){
      if (tg){ try{ tg.showAlert(msg); return; }catch(e){} }
      alert(msg);
    }
  </script>
</body>
</html>